@page
@using Model.DataModel.Additional.Common
@model App.Pages.Products.CaseModel
@{
}

<div class="d-flex justify-content-center align-items-center mb-5">
    <div>
        <h2 class="mb-0 mx-0 fs-1">@Model.Name</h2>
        <div>
            <span class="text-muted">Ocena</span>
            <span style="color: darkgoldenrod">
                @if(Model.AverageRate >= 2) {<i style="cursor: pointer" class="icon-star"></i>}
                else if (Model.AverageRate == 1) {<i style="cursor: pointer" class="icon-star-half-alt"></i>}
                else {<i style="cursor: pointer" class="icon-star-empty"></i>}
                @if (Model.AverageRate >= 4){<i style="cursor: pointer" class="icon-star"></i>}
                else if (Model.AverageRate == 3){<i style="cursor: pointer" class="icon-star-half-alt"></i>}
                else{<i style="cursor: pointer" class="icon-star-empty"></i>}
                @if (Model.AverageRate >= 6){<i style="cursor: pointer" class="icon-star"></i>}
                else if (Model.AverageRate == 5){<i style="cursor: pointer" class="icon-star-half-alt"></i>}
                else{<i style="cursor: pointer" class="icon-star-empty"></i>}
                @if (Model.AverageRate >= 8){<i style="cursor: pointer" class="icon-star"></i>}
                else if (Model.AverageRate == 7){<i style="cursor: pointer" class="icon-star-half-alt"></i>}
                else{<i style="cursor: pointer" class="icon-star-empty"></i>}
                @if (Model.AverageRate == 10){<i style="cursor: pointer" class="icon-star"></i>}
                else if (Model.AverageRate == 9){<i style="cursor: pointer" class="icon-star-half-alt"></i>}
                else{<i style="cursor: pointer" class="icon-star-empty"></i>}
            </span>
            <span class="text-muted">(@Model.ReviewsAmount)</span>
        </div>
        <div class="text-muted">
            Kategoria: Obudowa komputera
        </div>
        <div class="text-muted">
            Producent: @Model.Producer
        </div>
     </div>
</div>
<div class="container">
    <div class="row">
        <div class="col">
            <div class="displayImageArea mx-auto"> <img src="@Url.Page($"{HttpContext.Request.Path}", "MainImage",new {productId = Model.ProductId})" width="585" height="585" id="SelectedImageDisplay" />  </div>
            <div class="imagesArea mx-auto mt-3 d-flex">
                <img src="@Url.Page($"{HttpContext.Request.Path}", "MainImage",new {productId = Model.ProductId})" width="130" height="130" class="mx-1 productImage" id="MainImage" onclick="setDisplayImage('MainImage')" />
                @foreach(int imageId in Model.BonusProductImagesId)
                {
                    <img src="@Url.Page($"{HttpContext.Request.Path}", "BonusImage", new {imageId = imageId })" width="130" height="130" class="mx-1 productImage" id="BonusImage-@imageId" onclick="setDisplayImage('BonusImage-@imageId')" />
                }
            </div>

        </div>
        <div class="col">
            <div class="fs-1">
                @Model.Price zł
            </div>
            <div>
                <div class="mb-5">
                    @if ( true /*Model.Availability == Availability.Avabile */)
                    {
                        <form method="post">
                        <select class="fs-4">
                            <option value="1">1 szt</option>
                            <option value="2">2 szt</option>
                            <option value="3">3 szt</option>
                            <option value="4">4 szt</option>
                            <option value="5">5 szt</option>
                            <option value="6">6 szt</option>
                            <option value="7">7 szt</option>
                            <option value="8">8 szt</option>
                            <option value="9">9 szt</option>
                        </select>
                            <button class="narrowButton fs-4">
                            Dodaj do koszyka
                        </button>
                    </form>
                    }
                    else
                    {
                        <span class="productUnavailable">
                        Produkt niedostępny
                    </span>               
                    }
                </div>
                <table class="mt-5 shortProductTable">
                    <tr>
                        <td>
                            Producent
                        </td>
                        <td>
                            @Model.Producer
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Kategoria
                        </td>
                        <td>
                            Obudowa komputera
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Kolor
                        </td>
                        <td>
                            @Model.Color
                        </td>
                    </tr>
                    <tr>
                        <td >
                            Dodatkowe informacje
                        </td>
                        <td>
                            @Model.AdditionalInfo
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Format płyty głównej
                        </td>
                        <td>
                            @Model.MotherBoardFormats
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Formaty zasilacza
                        </td>
                        <td>
                            @Model.PowerSupplyFormat
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Typ zasilacza
                        </td>
                        <td>
                            @Model.CaseType.ToString();
                        </td>
                    </tr>
                </table>
            </div>
        </div>


        </div>
    <div class="row mt-5 mb-5">
        <div class="col">
                <h2 class=" mb-2">Opis Produktu</h2>
                <div>
                    @Model.Description
                </div>
            </div>
        </div>
    <div row mt-5>
        <h2 class="mb-2">Pełna specyfikacja</h2>
        <table class="fullProductTable">
            <tr>
                <td>
                    Producent
                </td>
                <td>
                    <div style="margin-left: 45%">@Model.Producer</div>
                </td>
            </tr>
            <tr>
                <td>
                    Kolor
                </td>
                <td>
                    <div style="margin-left: 45%">@Model.Color</div>
                </td>
            </tr>
            <tr>
                <td>
                    Dodatkowe informacje
                </td>
                <td>
                    <div style="margin-left: 45%">@Model.AdditionalInfo</div>
                </td>
            </tr>
            <tr>
                <td>
                    Format płyty głównej
                </td>
                <td>
                    <div style="margin-left: 45%">@Model.MotherBoardFormats</div>
                </td>
            </tr>
            <tr>
                <td>
                    Formaty zasilacza
                </td>
                <td>
                    <div style="margin-left: 45%">@Model.PowerSupplyFormat</div>
                </td>
            </tr>
            <tr>
                <td>
                    Typ zasilacza
                </td>
                <td>
                    <div style="margin-left: 45%">@Model.CaseType.ToString()</div>
                </td>
            </tr>
        </table>
    </div>
    <div class="row mt-5 mb-3">
        <div class="col">
            <h2>Opinie (@Model.ReviewsAmount)</h2>

        </div>
    </div>
    @if (Model.ReviewsAmount == 0)
    {
        <div class="row">
            <div class="col">
                <div class="fs-5" style="color: gray; text-align: center">
                    Nikt nie dodał jeszcze żadnych opinii do tego produktu. Możesz być pierwszy
                </div>
            </div>
        </div>
    }
    else
    {
        @foreach (var reviewDTO in Model.ReviewDTOs)
        {
            <div class="row mb-3">
                <div class="col">
                    <div id="review-@reviewDTO.Id" style="width: 100%; border: 1px solid lightgray; border-radius: 20px; padding: 10px">
                        <div>
                            <span class="fs-3">
                                <i class="icon-user-circle-o"></i>
                            </span>
                            <span class="fs-4 fw-bold">
                                @reviewDTO.Username
                            </span>
                            <span style="color: gray" class="fst-italic">
                                @reviewDTO.ReleaseDate.ToShortDateString()
                            </span>
                        </div>
                        <div class="mb-2" style="color: darkgoldenrod">
                            @if (reviewDTO.Rate >= 2)
                            {
                                <i style="cursor: pointer" class="icon-star"></i>
                            }
                            else
                            {
                                <i style="cursor: pointer" class="icon-star-empty"></i>
                            }
                            @if (reviewDTO.Rate >= 4)
                            {
                                <i style="cursor: pointer" class="icon-star"></i>
                            }
                            else
                            {
                                <i style="cursor: pointer" class="icon-star-empty"></i>
                            }
                            @if (reviewDTO.Rate >= 6)
                            {
                                <i style="cursor: pointer" class="icon-star"></i>
                            }
                            else
                            {
                                <i style="cursor: pointer" class="icon-star-empty"></i>
                            }
                            @if (reviewDTO.Rate >= 8)
                            {
                                <i style="cursor: pointer" class="icon-star"></i>
                            }
                            else
                            {
                                <i style="cursor: pointer" class="icon-star-empty"></i>
                            }
                            @if (reviewDTO.Rate >= 10)
                            {
                                <i style="cursor: pointer" class="icon-star"></i>
                            }
                            else
                            {
                                <i style="cursor: pointer" class="icon-star-empty"></i>
                            }

                        </div>
                        <div class="fs-6 mb-2">
                            @reviewDTO.Content
                        </div>
                        <div>
                            <span>
                                
                                    <a role="button" class="fs-6 link-secondary" onclick="document.getElementById('dialog-For-Review-@reviewDTO.Id').showModal()">Usuń</a>
                            </span>
                            <span>&nbsp;</span>
                            <span>
                                <a role="button" class="fs-6 link-secondary" onclick="hideFirstShowSecond('review-@reviewDTO.Id','edit-reviev-form-@reviewDTO.Id')">Edytuj</a>

                            </span>
                            <span>&nbsp;</span>
                            <span>
                                <a class="fs-6 link-secondary">Odpowiedz</a>
                            </span>
                        </div>
                        <dialog id="dialog-For-Review-@reviewDTO.Id">
                            Czy napewno chcesz usunąć opinię?<br />
                            <div style="text-align: center">                           
                                <span>&nbsp;</span>
                                <form method="post">
                                    <button asp-page-handler="ReviewDelete" asp-route-pageNumber="@Model.PageNumber" asp-route-productId="@Model.ProductId" asp-route-reviewId="@reviewDTO.Id" class="narrowButton">Tak</button>
                                    <button type="button" class="narrowButton" onclick="document.getElementById('dialog-For-Review-@reviewDTO.Id').close()">Nie</button>
                                </form>
                            </div>
                        </dialog>
                    </div>
                    <form asp-page-handler="EditReview" method="post" id="edit-reviev-form-@reviewDTO.Id" hidden>
                        <input type="hidden" value="@Model.ProductId" name="productId" />
                        <input type="hidden" value="@Model.PageNumber" name="pageNumber" />
                        <input type="hidden" name="rate" id="rateInAddReviewForm" value="2" />
                        <div style="float: left; width: 100%;" class="mb-0">
                            

                            <div style="display: inline-block; float: left; width: 100%;" class="mt-4">
                                <textarea id="review-textare-@reviewDTO.Id" style="resize: none; height: 80px; width: 100%;" placeholder="Twoja opinia o produkcie" name="reviewContent">@reviewDTO.Content</textarea>
                            </div>

                        </div>
                        <div class="fs-3" style="margin-top: -8px; display: inline-block; float: left; color: darkgoldenrod;">
                            <i style="cursor: pointer" class="demo-icon icon-star" id="firstStarInAddReviewForm"></i><i style="cursor: pointer" class="demo-icon icon-star-empty" id="secondStarInAddReviewForm"></i><i style="cursor: pointer" class="demo-icon icon-star-empty" id="thirdStarInAddReviewForm"></i><i style="cursor: pointer" class="demo-icon icon-star-empty" id="fourthStarInAddReviewForm"></i><i style="cursor: pointer" class="demo-icon icon-star-empty" id="fifthStarInAddReviewForm"></i>
                        </div>
                        <div style="display: inline-block; float: left;">
                            <input type="submit" class="narrowButton" value="Edytuj opinie">
                            <span>&nbsp;</span>
                            <button type="button" class="narrowButton" onclick="hideFirstShowSecond('edit-reviev-form-@reviewDTO.Id','review-@reviewDTO.Id')">Anuluj edycję</button>
                        </div>
                    </form>
                </div>
            </div>
        }
    }
    <div class="row">
        <div class="col">
            <div>
                @if (HttpContext.Session.GetInt32("isLogged") == 1)
                {
                    <form asp-page-handler="AddReview" method="post">
                        <input type="hidden" value="@Model.ProductId" name="productId" />
                        <input type="hidden" value="@Model.PageNumber" name="pageNumber" />
                        <input type="hidden" name="rate" id="rateInAddReviewForm" value="2"/>
                        <div style="float: left; width: 100%;" class="mb-0">
                            <div style="display: inline-block; float: left"><i class="demo-icon icon-user-circle-o" style="font-size:80px;"></i></div>

                            <div style="display: inline-block; width: calc(100% - 130px); float: left;" class="mt-4">
                                <textarea style="resize: none; height: 80px; width: 100%;" placeholder="Twoja opinia o produkcie" name="reviewContent"></textarea>
                            </div>

                        </div>
                        <div class="fs-3" style="margin-top: -8px; display: inline-block; float: left;  margin-left: 110px; color: darkgoldenrod;">
                            <i style="cursor: pointer" class="demo-icon icon-star" id="firstStarInAddReviewForm"></i><i style="cursor: pointer" class="demo-icon icon-star-empty" id="secondStarInAddReviewForm"></i><i style="cursor: pointer" class="demo-icon icon-star-empty" id="thirdStarInAddReviewForm"></i><i style="cursor: pointer" class="demo-icon icon-star-empty" id="fourthStarInAddReviewForm"></i><i style="cursor: pointer" class="demo-icon icon-star-empty" id="fifthStarInAddReviewForm"></i>
                        </div>
                        <div style="display: inline-block; float: left;"><input type="submit" class="narrowButton" value="Dodaj opinie"></div>
                    </form>
                }
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div style="text-align: center">
                @if (Model.ReviewsPageAmount<=9)
                {
                    @if (Model.ReviewsPageAmount >= 2)
                    {
                        
                        if (Model.PageNumber == 1)
                        {
                            <a class="link-dark fs-5" style="font-weight: bold">1</a>                        
                        }
                        else 
                        {
                            <a asp-page="@HttpContext.Request.Path" asp-route-pageNumber="1" asp-route-productId="@Model.ProductId" class="link-dark fs-5">1</a>
                        }
                        <span>&nbsp;</span>
                     
                    }
                    for (int i = 2; i <= Model.ReviewsPageAmount; i++)
                    {
                        if (Model.PageNumber == i)
                        {
                            <a class="link-dark fs-5" style="font-weight: bold">@i</a>                 
                        }
                        else
                        {
                            <a asp-page="@HttpContext.Request.Path" asp-route-pageNumber="@i" asp-route-productId="@Model.ProductId" class="link-dark fs-5">@i</a>
                        }
                        <span>&nbsp;</span>
                    }
                }
                else
                {
                    if (Model.PageNumber <= 5)
                    {
                        for (int i = 1; i <= 6; i++)
                        {
                            if (Model.PageNumber == i)
                            {
                                <a class="link-dark fs-5" style="font-weight: bold">@i</a>
                            }
                            else
                            {
                                <a asp-page="@HttpContext.Request.Path" asp-route-pageNumber="@i" asp-route-productId="@Model.ProductId" class="link-dark fs-5">@i</a>
                            }                           
                            <span>&nbsp;</span>
                        }
                        <span>...</span>
                        <span>&nbsp;</span>
                        for (int i = Model.ReviewsPageAmount - 2; i <= Model.ReviewsPageAmount; i++)
                        {
                            if (Model.PageNumber == i)
                            {
                                <a class="link-dark fs-5" style="font-weight: bold">@i</a>
                            }
                            else
                            {
                                <a asp-page="@HttpContext.Request.Path" asp-route-pageNumber="@i" asp-route-productId="@Model.ProductId" class="link-dark fs-5">@i</a>
                            }
                            <span>&nbsp;</span>
                        }
                        
                    }
                    else if (Model.PageNumber >= 4 && Model.PageNumber<Model.ReviewsPageAmount-4)
                    {
                        for (int i = 1; i <= 3; i++)
                        {
                            if (Model.PageNumber == i)
                            {
                                <a class="link-dark fs-5" style="font-weight: bold">@i</a>
                            }
                            else
                            {
                                <a asp-page="@HttpContext.Request.Path" asp-route-pageNumber="@i" asp-route-productId="@Model.ProductId" class="link-dark fs-5">@i</a>
                            }
                            <span>&nbsp;</span>
                        }

                        <span>...</span>
                        <span>&nbsp;</span>

                        for (int i = Model.PageNumber - 1; i <= Model.PageNumber + 1; i++)
                        {
                            if (Model.PageNumber == i)
                            {
                                <a class="link-dark fs-5" style="font-weight: bold">@i</a>
                            }
                            else
                            {
                                <a asp-page="@HttpContext.Request.Path" asp-route-pageNumber="@i" asp-route-productId="@Model.ProductId" class="link-dark fs-5">@i</a>
                            }
                            <span>&nbsp;</span>
                        }

                        <span>...</span>
                        <span>&nbsp;</span>

                        for (int i = Model.ReviewsPageAmount-2; i <= Model.ReviewsPageAmount; i++)
                        {
                            if (Model.PageNumber == i)
                            {
                                <a class="link-dark fs-5" style="font-weight: bold">@i</a>
                            }
                            else
                            {
                                <a asp-page="@HttpContext.Request.Path" asp-route-pageNumber="@i" asp-route-productId="@Model.ProductId" class="link-dark fs-5">@i</a>
                            }
                            <span>&nbsp;</span>
                        }   
                    }
                    else if (Model.PageNumber > 5 && Model.PageNumber >= Model.ReviewsPageAmount - 4)
                    {
                        for (int i = 1; i <= 3; i++)
                        {
                            if (Model.PageNumber == i)
                            {
                                <a class="link-dark fs-5" style="font-weight: bold">@i</a>
                            }
                            else
                            {
                                <a asp-page="@HttpContext.Request.Path" asp-route-pageNumber="@i" asp-route-productId="@Model.ProductId" class="link-dark fs-5">@i</a>
                            }
                            <span>&nbsp;</span>
                        }
                        <span>...</span>
                        <span>&nbsp;</span>
                        for (int i = Model.ReviewsPageAmount - 5; i <= Model.ReviewsPageAmount; i++)
                        {
                            if (Model.PageNumber == i)
                            {
                                <a class="link-dark fs-5" style="font-weight: bold">@i</a>
                            }
                            else
                            {
                                <a asp-page="@HttpContext.Request.Path" asp-route-pageNumber="@i" asp-route-productId="@Model.ProductId" class="link-dark fs-5">@i</a>
                            }
                            <span>&nbsp;</span>
                        }
                    }
                }
            </div>
        </div>
    </div>
</div>
<script src="~/js/productView.js"></script>